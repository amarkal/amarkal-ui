!function(t){var e=window.jQuery;t.UI={components:{},registerComponent:function(t,e){Amarkal.UI.components.hasOwnProperty(t)?console.error("Attempting to register an existing component type '"+t+"'"):Amarkal.UI.components[t]=e},getComponentConfig:function(t){if(Amarkal.UI.components.hasOwnProperty(t))return Amarkal.UI.components[t];console.error("A component type '"+t+"' has not been registered")},createComponent:function(t){var n=t.attr("class").match(/amarkal-ui-component-([a-z]+)/)[1],i=Amarkal.UI.getComponentConfig(n),a=e.extend({},Amarkal.UI.abstractComponent,i);a.$el=t,a.props=JSON.parse(t.children(".amarkal-ui-component-props").text());for(var o in a)"function"==typeof a[o]&&(a[o]=a[o].bind(a));return a.onInit(),a},init:function(){e(".amarkal-ui-component").amarkalUIComponent()}},e(document).ready(function(){Amarkal.UI.init()}),Amarkal.UI.abstractComponent={$el:null,props:{},validity:null,instance:function(){return this},reset:function(){this.makeValid()},getValue:function(){return null},setValue:function(){},refresh:function(){},setValidity:function(t){t===this.VALID&&this.$el.removeClass("amarkal-ui-component-error"),t===this.INVALID&&this.$el.addClass("amarkal-ui-component-error"),this.validity=t},getValidity:function(){return this.validity},getName:function(){return this.props.name},makeInvalid:function(){this.setValidity(this.INVALID)},makeValid:function(){this.setValidity(this.VALID)},onInit:function(){},onChange:function(){this.$el.trigger("amarkal.change",[this])},VALID:"valid",INVALID:"invalid"},Amarkal.UI.form={getData:function(t){var n={};return t.find(".amarkal-ui-component").each(function(){if(!e(this).parents(".amarkal-ui-component").length){var t=e(this).amarkalUIComponent("getName"),i=e(this).amarkalUIComponent("getValue");void 0!==t&&(n[t]=i)}}),n},setData:function(t,n,i){t.find(".amarkal-ui-component").each(function(){if(!e(this).parents(".amarkal-ui-component").length){var t=e(this).amarkalUIComponent("getName");if(void 0===t)return;if(void 0!==i&&i.hasOwnProperty(t))return;n.hasOwnProperty(t)&&e(this).amarkalUIComponent("setValue",n[t])}})}},e.fn.extend({amarkalUIComponent:function(t){var n,i,a=arguments.length>1?Array.apply(null,arguments).slice(1):null;return n=this.each(function(){if(!e(this).hasClass("amarkal-ui-component"))throw"This element is not an Amarkal UI component";void 0===e(this).data("amarkal-ui-component")&&e(this).data("amarkal-ui-component",Amarkal.UI.createComponent(e(this)));var n=e(this).data("amarkal-ui-component");if(void 0!==t&&n.hasOwnProperty(t)&&void 0!==(i=n[t].apply(n,a)))return!1}),void 0!==i?i:n}}),e.fn.extend({amarkalUIForm:function(t){var n=arguments.length>1?Array.apply(null,arguments).slice(1):[],i={},a=e(this[0]);return n.unshift(a),void 0!==t&&Amarkal.UI.form.hasOwnProperty(t)&&(i=Amarkal.UI.form[t].apply(null,n)),i}}),Amarkal.UI.registerComponent("button",{onInit:function(){this._setState("start"),this.props.disabled||this.$el.on("click",this._onClick)},_doing:!1,_onClick:function(t){t.preventDefault(),this._doing||(this._doing=!0,this._setState("doing"),e.ajax({url:this.props.request_url,data:this._getRequestData(),method:this.props.request_method,success:this._onDone,error:this._onError}))},_getRequestData:function(){var t=Object.assign({},this.props.request_data),e=this.$el.closest("form").amarkalUIForm("getData");for(key in t)t[key]=t[key].replace(/(\{\{([\w\d-]*)\}\})/g,function(t,n,i){return e[i.trim()]});return t},_onDone:function(t){var e=this;this._setState("done"),setTimeout(function(){e._setState("start"),e._doing=!1},3e3)},_onError:function(){var t=this;this._setState("error"),setTimeout(function(){t._setState("start"),t._doing=!1},3e3)},_setState:function(t){this.$el.find("button").text(this.props["label_"+t]).attr("class","").addClass("amarkal-ui-"+t)}}),Amarkal.UI.registerComponent("checkbox",{setValue:function(t){if(this.$el.find("input").attr("checked",!1),t.length)for(var e=0;e<t.length;e++)this.$el.find('input[value="'+t[e]+'"]').attr("checked",!0)},getValue:function(){return this.$el.find("input:checked").toArray().map(function(t){return t.value})},onInit:function(){var t=this;this.$el.find("input").on("change",function(){t.onChange()})}}),Amarkal.UI.registerComponent("code",{editor:null,setValue:function(t){this.editor.setValue(t),this.editor.navigateLineEnd(),this.$el.children("textarea").val(t)},getValue:function(){return this.editor.getValue()},onInit:function(){var t=this,e=this.$el.find(".amarkal-ui-component-ace-editor");ace.config.set("basePath","https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.8/"),this.editor=ace.edit(e[0]),this.editor.getSession().setUseWorker(!1),this.editor.setTheme("ace/theme/"+this.props.theme),this.editor.getSession().setMode("ace/mode/"+this.props.language),this.editor.setOptions({maxLines:this.props.max_lines}),this.editor.setReadOnly(this.props.readonly||this.props.disabled),this.setValue(this.props.value),e.on("keyup",function(){t.onChange(),t.$el.children("textarea").val(t.editor.getValue())})},refresh:function(){this.editor.resize(),this.editor.renderer.updateFull()}}),Amarkal.UI.registerComponent("composite",{setValue:function(t){for(var e in t)this.$el.find('[amarkal-component-name="'+e+'"]').amarkalUIComponent("setValue",t[e])},getValue:function(){var t={};return this.$el.find(".amarkal-ui-component").each(function(){var n=e(this).attr("amarkal-component-name");e(this).amarkalUIComponent(),t[n]=e(this).amarkalUIComponent("getValue")}),t},onInit:function(){var t=this;this.$el.find(".amarkal-ui-component").on("amarkal.change",function(){t.onChange()})}}),Amarkal.UI.registerComponent("html",{}),Amarkal.UI.registerComponent("number",{setValue:function(t){this.$el.find("input").val(t)},getValue:function(){return this.$el.find("input").val()},onInit:function(){var t=this;this.$el.find("input").on("change",function(){t.onChange()})}}),Amarkal.UI.registerComponent("progressbar",{setValue:function(t){this.props.value=t,this.refresh()},getValue:function(){return this.props.value},onInit:function(){this.$el.find(".amarkal-ui-value-label");this._setProps(),this._updateLabel(),this._populateValueLabels(),e(window).on("resize",this.refresh)},refresh:function(){this._updateLabel(),this._populateValueLabels()},_setProps:function(){this.props=e.extend({},this.props,{delta:Math.abs(this.props.max-this.props.min),labelWidth:30,minSpacing:50})},_updateLabel:function(){var t=100*(this.props.value-this.props.min)/this.props.delta;this.$el.find(".amarkal-ui-progressbar-inner").css({width:t+"%"}),this.$el.find(".amarkal-ui-value-label").text(this.getValue()).css({left:t+"%"})},_populateValueLabels:function(){var t=this.$el.find(".amarkal-ui-progressbar"),e=this.$el.find(".amarkal-ui-progressbar-values"),n=this._formatNumber,i=this.props,a=i.labelWidth,o=i.minSpacing,s=(this.getValue(),t.width()),r=Math.floor(Math.min((s+o)/(a+o),i.delta+1));e.html(function(){for(var t="",e=0;e<r;e++){var a=i.delta/(r-1)*e+i.min;t+="<span>"+n(a)+"</span>"}return t}())},_formatNumber:function(t){var e=this.props.delta,n=this.props.step;return e/1e6>1?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":e/1e3>1?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":n<1?t.toFixed(1).replace(/\.0$/,""):Math.round(t)}}),Amarkal.UI.registerComponent("radio",{setValue:function(t){this.$el.find("input").attr("checked",!1),this.$el.find('input[value="'+t+'"]').attr("checked",!0)},getValue:function(){return this.$el.find("input:checked").val()},onInit:function(){var t=this;this.$el.find("input").on("change",function(){t.onChange()})}}),Amarkal.UI.registerComponent("select",{setValue:function(t){this.$el.find("select > option").attr("selected",!1),this.$el.find('select > option[value="'+t+'"]').attr("selected",!0)},getValue:function(){return this.$el.find("select").val()},onInit:function(){var t=this;this.$el.find("select").on("change",function(){t.onChange()})}}),Amarkal.UI.registerComponent("slider",{setValue:function(t){this.$el.find("input").val(t),this._updateLabelPosition(),this._updateLabelValue(t)},getValue:function(){return this.$el.find("input").val()},onInit:function(){var t=this,n=this.$el.find("input");this.$el.find(".slider-value-label");this._setProps(),this._updateLabelPosition(),this._populateValueLabels(),this._updateLabelValue(n.val()),n.on("input change",function(){t._updateLabelValue(n.val()),t._updateLabelPosition(),t.onChange()}),e(window).on("resize",this.refresh)},refresh:function(){this._updateLabelPosition(),this._populateValueLabels()},_setProps:function(){this.props=e.extend({},this.props,{delta:Math.abs(this.props.max-this.props.min),knobWidth:26,labelWidth:30,minSpacing:50})},_updateLabelPosition:function(){var t=this.$el.find("input"),e=this.props,n=t.val(),i=t.width(),a=e.knobWidth/2+(i-e.knobWidth)*(n-e.min)/e.delta;this.$el.find(".slider-value-label").css({left:a+"px"})},_updateLabelValue:function(t){this.$el.find(".slider-value-label").text(t)},_populateValueLabels:function(){var t=this.$el.find("input"),e=this.$el.find(".slider-values"),n=this._formatNumber,i=this.props,a=i.labelWidth,o=i.minSpacing,s=(t.val(),t.width()),r=Math.floor(Math.min((s+o)/(a+o),i.delta/i.step+1));e.html(function(){for(var t="",e=0;e<r;e++){var a=i.delta/(r-1)*e+i.min;t+="<span>"+n(a)+"</span>"}return t}())},_formatNumber:function(t){var e=this.props.delta,n=this.props.step;return e/1e6>1?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":e/1e3>1?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":n<1?t.toFixed(1).replace(/\.0$/,""):Math.round(t)}}),Amarkal.UI.registerComponent("switch",{setValue:function(t){this.$el.find('input[type="hidden"]').val(t),"on"===t?this.$el.find('input[type="checkbox"]').attr("checked",!0):this.$el.find('input[type="checkbox"]').attr("checked",!1)},getValue:function(){return this.$el.find('input[type="hidden"]').val()},onInit:function(){var t=this;this.$el.find('input[type="checkbox"]').on("change",function(e){t.onChange(),t.$el.find('input[type="hidden"]').val(e.target.checked?"on":"off")})}}),Amarkal.UI.registerComponent("text",{setValue:function(t){this.$el.find("input").val(t)},getValue:function(){return this.$el.find("input").val()},onInit:function(){var t=this;this.$el.on("keyup",function(){t.onChange()})}}),Amarkal.UI.registerComponent("textarea",{setValue:function(t){this.$el.find("textarea").val(t)},getValue:function(){return this.$el.find("textarea").val()},onInit:function(){var t=this;this.$el.find("textarea").on("keyup",function(){t.onChange()})}}),Amarkal.UI.registerComponent("toggle",{setValue:function(t){this.props.multi?this.$el.find("input").val(t.join(",")):this.$el.find("input").val(t),this._setActiveValues(t)},getValue:function(){var t=this.$el.find("input").val();return this.props.multi?t.split(","):t},onInit:function(){var t=this;this.props.disabled||this.$el.find(".amarkal-ui-toggle-labels div").on("click",function(){t._onClick(e(this))})},_onClick:function(t){var e;this.getValue();this.props.multi?(t.toggleClass("active"),e=this._getActiveValues()):(t.siblings().removeClass("active"),t.addClass("active"),e=t.attr("data-value")),this.setValue(e),this.onChange()},_getActiveValues:function(){var t=[];return this.$el.find(".amarkal-ui-toggle-labels div.active").each(function(){t.push(e(this).attr("data-value"))}),t},_setActiveValues:function(t){var n=this.props.multi;this.$el.find(".amarkal-ui-toggle-labels div").each(function(){var i=e(this).attr("data-value");e(this).removeClass("active"),(n&&t.indexOf(i)>-1||!n&&t===i)&&e(this).addClass("active")})}})}("undefined"==typeof Amarkal?Amarkal={}:Amarkal);
//# sourceMappingURL=amarkal-ui.min.js.map