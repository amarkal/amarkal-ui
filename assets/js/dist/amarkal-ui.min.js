!function(t,n){var e;void 0===n.Amarkal?(e={},n.Amarkal=e):e=n.Amarkal,e.UI={components:{},registerComponent:function(t,n){e.UI.components.hasOwnProperty(t)?console.error("Attempting to register an existing component type '"+t+"'"):e.UI.components[t]=n},getComponentConfig:function(t){if(e.UI.components.hasOwnProperty(t))return e.UI.components[t];console.error("A component type '"+t+"' has not been registered")},createComponent:function(n){var i=n.attr("class").match(/amarkal-ui-component-([a-z]+)/)[1],a=e.UI.getComponentConfig(i),o=t.extend({},e.UI.abstractComponent,a);o.$el=n,o.props=JSON.parse(n.children(".amarkal-ui-component-props").text());for(var r in o)"function"==typeof o[r]&&(o[r]=o[r].bind(o));return o.onInit(),o},init:function(){t(".amarkal-ui-component").amarkalUIComponent()}},t(document).ready(function(){e.UI.init()}),e.UI.abstractComponent={$el:null,props:{},validity:null,reset:function(){this.makeValid()},getValue:function(){return null},setValue:function(){},refresh:function(){},setValidity:function(t){t===this.VALID&&this.$el.removeClass("amarkal-ui-component-error"),t===this.INVALID&&this.$el.addClass("amarkal-ui-component-error"),this.validity=t},getValidity:function(){return this.validity},getName:function(){return this.$el.attr("amarkal-component-name")},makeInvalid:function(){this.setValidity(this.INVALID)},makeValid:function(){this.setValidity(this.VALID)},onInit:function(){},onChange:function(){this.$el.trigger("amarkal.change",[this])},VALID:"valid",INVALID:"invalid"},e.UI.form={getData:function(n){var e={};return n.find(".amarkal-ui-component").each(function(){if(!t(this).parents(".amarkal-ui-component").length){var n=t(this).amarkalUIComponent("getName"),i=t(this).amarkalUIComponent("getValue");e[n]=i}}),e},setData:function(n,e,i){n.find(".amarkal-ui-component").each(function(){if(!t(this).parents(".amarkal-ui-component").length){var n=t(this).amarkalUIComponent("getName");void 0===i||i.hasOwnProperty(n)||t(this).amarkalUIComponent("setValue",e[n])}})}},t.fn.extend({amarkalUIComponent:function(n){var i,a,o=arguments.length>1?Array.apply(null,arguments).slice(1):null;return i=this.each(function(){if(!t(this).hasClass("amarkal-ui-component"))throw"This element is not an Amarkal UI component";void 0===t(this).data("amarkal-ui-component")&&t(this).data("amarkal-ui-component",e.UI.createComponent(t(this)));var i=t(this).data("amarkal-ui-component");if(void 0!==n&&i.hasOwnProperty(n)&&void 0!==(a=i[n].apply(i,o)))return!1}),void 0!==a?a:i}}),t.fn.extend({amarkalUIForm:function(n){var i=arguments.length>1?Array.apply(null,arguments).slice(1):[],a={},o=t(this[0]);return i.unshift(o),void 0!==n&&e.UI.form.hasOwnProperty(n)&&(a=e.UI.form[n].apply(null,i)),a}}),e.UI.registerComponent("button",{onInit:function(){this._setState("start"),this.$el.on("click",this._onClick)},_doing:!1,_onClick:function(n){n.preventDefault(),this._doing||(this._doing=!0,this._setState("doing"),t.ajax({url:this.props.request_url,data:this.props.request_data,method:this.props.request_method,success:this._onDone,error:this._onError}))},_onDone:function(t){var n=this;this._setState("done"),setTimeout(function(){n._setState("start"),n._doing=!1},3e3)},_onError:function(){var t=this;this._setState("error"),setTimeout(function(){t._setState("start"),t._doing=!1},3e3)},_setState:function(t){this.$el.find("button").text(this.props["label_"+t]).attr("class","").addClass("amarkal-ui-"+t)}}),e.UI.registerComponent("checkbox",{setValue:function(t){if(this.$el.find("input").attr("checked",!1),t.length)for(var n=0;n<t.length;n++)this.$el.find('input[value="'+t[n]+'"]').attr("checked",!0)},getValue:function(){return this.$el.find("input:checked").toArray().map(function(t){return t.value})},onInit:function(){var t=this;this.$el.find("input").on("change",function(){t.onChange()})}}),e.UI.registerComponent("composite",{setValue:function(t){for(var n in t)this.$el.find('[amarkal-component-name="'+n+'"]').amarkalUIComponent("setValue",t[n])},getValue:function(){var n={};return this.$el.find(".amarkal-ui-component").each(function(){var e=t(this).attr("amarkal-component-name");t(this).amarkalUIComponent(),n[e]=t(this).amarkalUIComponent("getValue")}),n},onInit:function(){var t=this;this.$el.find(".amarkal-ui-component").on("amarkal.change",function(){t.onChange()})}}),e.UI.registerComponent("number",{setValue:function(t){this.$el.find("input").val(t)},getValue:function(){return this.$el.find("input").val()},onInit:function(){var t=this;this.$el.find("input").on("change",function(){t.onChange()})}}),e.UI.registerComponent("radio",{setValue:function(t){this.$el.find("input").attr("checked",!1),this.$el.find('input[value="'+t+'"]').attr("checked",!0)},getValue:function(){return this.$el.find("input:checked").val()},onInit:function(){var t=this;this.$el.find("input").on("change",function(){t.onChange()})}}),e.UI.registerComponent("select",{setValue:function(t){this.$el.find("select > option").attr("selected",!1),this.$el.find('select > option[value="'+t+'"]').attr("selected",!0)},getValue:function(){return this.$el.find("select").val()},onInit:function(){var t=this;this.$el.find("select").on("change",function(){t.onChange()})}}),e.UI.registerComponent("slider",{setValue:function(t){this.$el.find("input").val(t),this._updateLabelPosition(),this._updateLabelValue(t)},getValue:function(){return this.$el.find("input").val()},onInit:function(){var n=this,e=this.$el.find("input");this.$el.find(".slider-value-label");this._setProps(),this._updateLabelPosition(),this._populateValueLabels(),this._updateLabelValue(e.val()),e.on("input change",function(){n._updateLabelValue(e.val()),n._updateLabelPosition(),n.onChange()}),t(window).on("resize",this.refresh)},refresh:function(){this._updateLabelPosition(),this._populateValueLabels()},_setProps:function(){this.props=t.extend({},this.props,{delta:Math.abs(this.props.max-this.props.min),knobWidth:26,labelWidth:30,minSpacing:50})},_updateLabelPosition:function(){var t=this.$el.find("input"),n=this.props,e=t.val(),i=t.width(),a=n.knobWidth/2+(i-n.knobWidth)*(e-n.min)/n.delta;this.$el.find(".slider-value-label").css({left:a+"px"})},_updateLabelValue:function(t){this.$el.find(".slider-value-label").text(t)},_populateValueLabels:function(){var t=this.$el.find("input"),n=this.$el.find(".slider-values"),e=this._formatNumber,i=this.props,a=i.labelWidth,o=i.minSpacing,r=(t.val(),t.width()),s=Math.floor(Math.min((r+o)/(a+o),i.delta/i.step+1));n.html(function(){for(var t="",n=0;n<s;n++){var a=i.delta/(s-1)*n+i.min;t+="<span>"+e(a)+"</span>"}return t}())},_formatNumber:function(t){var n=this.props.delta,e=this.props.step;return n/1e6>1?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":n/1e3>1?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":e<1?t.toFixed(1).replace(/\.0$/,""):Math.round(t)}}),e.UI.registerComponent("switch",{setValue:function(t){this.$el.find('input[type="hidden"]').val(t),"on"===t?this.$el.find('input[type="checkbox"]').attr("checked",!0):this.$el.find('input[type="checkbox"]').attr("checked",!1)},getValue:function(){return this.$el.find('input[type="hidden"]').val()},onInit:function(){var t=this;this.$el.find('input[type="checkbox"]').on("change",function(n){t.onChange(),t.$el.find('input[type="hidden"]').val(n.target.checked?"on":"off")})}}),e.UI.registerComponent("text",{setValue:function(t){this.$el.find("input").val(t)},getValue:function(){return this.$el.find("input").val()},onInit:function(){var t=this;this.$el.on("keyup",function(){t.onChange()})}}),e.UI.registerComponent("textarea",{setValue:function(t){this.$el.find("textarea").val(t)},getValue:function(){return this.$el.find("textarea").val()},onInit:function(){var t=this;this.$el.find("textarea").on("keyup",function(){t.onChange()})}})}(jQuery,window);