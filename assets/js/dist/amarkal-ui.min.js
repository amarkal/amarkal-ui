!function(t,e){var n;void 0===e.Amarkal?(n={},e.Amarkal=n):n=e.Amarkal,n.UI={components:{},registerComponent:function(t,e){n.UI.components.hasOwnProperty(t)?console.error("Attempting to register an existing component type '"+t+"'"):n.UI.components[t]=e},getComponentConfig:function(t){if(n.UI.components.hasOwnProperty(t))return n.UI.components[t];console.error("A component type '"+t+"' has not been registered")},createComponent:function(e){var i=e.attr("class").match(/amarkal-ui-component-([a-z]+)/)[1],a=n.UI.getComponentConfig(i),o=t.extend({},n.UI.abstractComponent,a);o.$el=e,o.props=JSON.parse(e.children(".amarkal-ui-component-props").text());for(var s in o)"function"==typeof o[s]&&(o[s]=o[s].bind(o));return o.onInit(),o},init:function(){t(".amarkal-ui-component").amarkalUIComponent()}},t(document).ready(function(){n.UI.init()}),n.UI.abstractComponent={$el:null,props:{},validity:null,reset:function(){this.makeValid()},getValue:function(){return null},setValue:function(){},refresh:function(){},setValidity:function(t){t===this.VALID&&this.$el.removeClass("amarkal-ui-component-error"),t===this.INVALID&&this.$el.addClass("amarkal-ui-component-error"),this.validity=t},getValidity:function(){return this.validity},getName:function(){return this.$el.attr("amarkal-component-name")},makeInvalid:function(){this.setValidity(this.INVALID)},makeValid:function(){this.setValidity(this.VALID)},onInit:function(){},onChange:function(){this.$el.trigger("amarkal.change",[this])},VALID:"valid",INVALID:"invalid"},n.UI.form={getData:function(e){var n={};return e.find(".amarkal-ui-component").each(function(){if(!t(this).parents(".amarkal-ui-component").length){var e=t(this).amarkalUIComponent("getName"),i=t(this).amarkalUIComponent("getValue");n[e]=i}}),n},setData:function(e,n,i){e.find(".amarkal-ui-component").each(function(){if(!t(this).parents(".amarkal-ui-component").length){var e=t(this).amarkalUIComponent("getName");void 0===i||i.hasOwnProperty(e)||t(this).amarkalUIComponent("setValue",n[e])}})}},t.fn.extend({amarkalUIComponent:function(e){var i,a,o=arguments.length>1?Array.apply(null,arguments).slice(1):null;return i=this.each(function(){if(!t(this).hasClass("amarkal-ui-component"))throw"This element is not an Amarkal UI component";void 0===t(this).data("amarkal-ui-component")&&t(this).data("amarkal-ui-component",n.UI.createComponent(t(this)));var i=t(this).data("amarkal-ui-component");if(void 0!==e&&i.hasOwnProperty(e)&&void 0!==(a=i[e].apply(i,o)))return!1}),void 0!==a?a:i}}),t.fn.extend({amarkalUIForm:function(e){var i=arguments.length>1?Array.apply(null,arguments).slice(1):[],a={},o=t(this[0]);return i.unshift(o),void 0!==e&&n.UI.form.hasOwnProperty(e)&&(a=n.UI.form[e].apply(null,i)),a}}),n.UI.registerComponent("button",{onInit:function(){this._setState("start"),this.$el.on("click",this._onClick)},_doing:!1,_onClick:function(e){e.preventDefault(),this._doing||(this._doing=!0,this._setState("doing"),t.ajax({url:this.props.request_url,data:this.props.request_data,method:this.props.request_method,success:this._onDone,error:this._onError}))},_onDone:function(t){var e=this;this._setState("done"),setTimeout(function(){e._setState("start"),e._doing=!1},3e3)},_onError:function(){var t=this;this._setState("error"),setTimeout(function(){t._setState("start"),t._doing=!1},3e3)},_setState:function(t){this.$el.find("button").text(this.props["label_"+t]).attr("class","").addClass("amarkal-ui-"+t)}}),n.UI.registerComponent("checkbox",{setValue:function(t){if(this.$el.find("input").attr("checked",!1),t.length)for(var e=0;e<t.length;e++)this.$el.find('input[value="'+t[e]+'"]').attr("checked",!0)},getValue:function(){return this.$el.find("input:checked").toArray().map(function(t){return t.value})},onInit:function(){var t=this;this.$el.find("input").on("change",function(){t.onChange()})}}),n.UI.registerComponent("code",{editor:null,setValue:function(t){this.editor.setValue(t),this.editor.navigateLineEnd()},getValue:function(){return this.editor.getValue()},onInit:function(){var t=this,e=this.$el.find(".amarkal-ui-component-ace-editor");ace.config.set("basePath","https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.8/"),this.editor=ace.edit(e[0]),this.editor.getSession().setUseWorker(!1),this.editor.setTheme("ace/theme/"+this.props.theme),this.editor.getSession().setMode("ace/mode/"+this.props.language),this.editor.setOptions({maxLines:this.props.max_lines}),this.editor.setReadOnly(this.props.readonly||this.props.disabled),e.on("keyup",function(){t.onChange(),t.$el.children("textarea").val(t.editor.getValue())})},refresh:function(){this.editor.resize(),this.editor.renderer.updateFull()}}),n.UI.registerComponent("composite",{setValue:function(t){for(var e in t)this.$el.find('[amarkal-component-name="'+e+'"]').amarkalUIComponent("setValue",t[e])},getValue:function(){var e={};return this.$el.find(".amarkal-ui-component").each(function(){var n=t(this).attr("amarkal-component-name");t(this).amarkalUIComponent(),e[n]=t(this).amarkalUIComponent("getValue")}),e},onInit:function(){var t=this;this.$el.find(".amarkal-ui-component").on("amarkal.change",function(){t.onChange()})}}),n.UI.registerComponent("number",{setValue:function(t){this.$el.find("input").val(t)},getValue:function(){return this.$el.find("input").val()},onInit:function(){var t=this;this.$el.find("input").on("change",function(){t.onChange()})}}),n.UI.registerComponent("progressbar",{setValue:function(t){this.props.value=t,this.refresh()},getValue:function(){return this.props.value},onInit:function(){this.$el.find(".amarkal-ui-value-label");this._setProps(),this._updateLabel(),this._populateValueLabels(),t(window).on("resize",this.refresh)},refresh:function(){this._updateLabel(),this._populateValueLabels()},_setProps:function(){this.props=t.extend({},this.props,{delta:Math.abs(this.props.max-this.props.min),labelWidth:30,minSpacing:50})},_updateLabel:function(){var t=100*(this.props.value-this.props.min)/this.props.delta;this.$el.find(".amarkal-ui-progressbar-inner").css({width:t+"%"}),this.$el.find(".amarkal-ui-value-label").text(this.getValue()).css({left:t+"%"})},_populateValueLabels:function(){var t=this.$el.find(".amarkal-ui-progressbar"),e=this.$el.find(".amarkal-ui-progressbar-values"),n=this._formatNumber,i=this.props,a=i.labelWidth,o=i.minSpacing,s=(this.getValue(),t.width()),r=Math.floor(Math.min((s+o)/(a+o),i.delta+1));e.html(function(){for(var t="",e=0;e<r;e++){var a=i.delta/(r-1)*e+i.min;t+="<span>"+n(a)+"</span>"}return t}())},_formatNumber:function(t){var e=this.props.delta,n=this.props.step;return e/1e6>1?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":e/1e3>1?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":n<1?t.toFixed(1).replace(/\.0$/,""):Math.round(t)}}),n.UI.registerComponent("radio",{setValue:function(t){this.$el.find("input").attr("checked",!1),this.$el.find('input[value="'+t+'"]').attr("checked",!0)},getValue:function(){return this.$el.find("input:checked").val()},onInit:function(){var t=this;this.$el.find("input").on("change",function(){t.onChange()})}}),n.UI.registerComponent("select",{setValue:function(t){this.$el.find("select > option").attr("selected",!1),this.$el.find('select > option[value="'+t+'"]').attr("selected",!0)},getValue:function(){return this.$el.find("select").val()},onInit:function(){var t=this;this.$el.find("select").on("change",function(){t.onChange()})}}),n.UI.registerComponent("slider",{setValue:function(t){this.$el.find("input").val(t),this._updateLabelPosition(),this._updateLabelValue(t)},getValue:function(){return this.$el.find("input").val()},onInit:function(){var e=this,n=this.$el.find("input");this.$el.find(".slider-value-label");this._setProps(),this._updateLabelPosition(),this._populateValueLabels(),this._updateLabelValue(n.val()),n.on("input change",function(){e._updateLabelValue(n.val()),e._updateLabelPosition(),e.onChange()}),t(window).on("resize",this.refresh)},refresh:function(){this._updateLabelPosition(),this._populateValueLabels()},_setProps:function(){this.props=t.extend({},this.props,{delta:Math.abs(this.props.max-this.props.min),knobWidth:26,labelWidth:30,minSpacing:50})},_updateLabelPosition:function(){var t=this.$el.find("input"),e=this.props,n=t.val(),i=t.width(),a=e.knobWidth/2+(i-e.knobWidth)*(n-e.min)/e.delta;this.$el.find(".slider-value-label").css({left:a+"px"})},_updateLabelValue:function(t){this.$el.find(".slider-value-label").text(t)},_populateValueLabels:function(){var t=this.$el.find("input"),e=this.$el.find(".slider-values"),n=this._formatNumber,i=this.props,a=i.labelWidth,o=i.minSpacing,s=(t.val(),t.width()),r=Math.floor(Math.min((s+o)/(a+o),i.delta/i.step+1));e.html(function(){for(var t="",e=0;e<r;e++){var a=i.delta/(r-1)*e+i.min;t+="<span>"+n(a)+"</span>"}return t}())},_formatNumber:function(t){var e=this.props.delta,n=this.props.step;return e/1e6>1?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":e/1e3>1?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":n<1?t.toFixed(1).replace(/\.0$/,""):Math.round(t)}}),n.UI.registerComponent("switch",{setValue:function(t){this.$el.find('input[type="hidden"]').val(t),"on"===t?this.$el.find('input[type="checkbox"]').attr("checked",!0):this.$el.find('input[type="checkbox"]').attr("checked",!1)},getValue:function(){return this.$el.find('input[type="hidden"]').val()},onInit:function(){var t=this;this.$el.find('input[type="checkbox"]').on("change",function(e){t.onChange(),t.$el.find('input[type="hidden"]').val(e.target.checked?"on":"off")})}}),n.UI.registerComponent("text",{setValue:function(t){this.$el.find("input").val(t)},getValue:function(){return this.$el.find("input").val()},onInit:function(){var t=this;this.$el.on("keyup",function(){t.onChange()})}}),n.UI.registerComponent("textarea",{setValue:function(t){this.$el.find("textarea").val(t)},getValue:function(){return this.$el.find("textarea").val()},onInit:function(){var t=this;this.$el.find("textarea").on("keyup",function(){t.onChange()})}}),n.UI.registerComponent("toggle",{setValue:function(t){this.props.multi?this.$el.find("input").val(t.join(",")):this.$el.find("input").val(t),this._setActiveValues(t)},getValue:function(){var t=this.$el.find("input").val();return this.props.multi?t.split(","):t},onInit:function(){var e=this;this.$el.find(".amarkal-ui-toggle-labels div").on("click",function(){var n;e.getValue();e.props.multi?(t(this).toggleClass("active"),n=e._getActiveValues()):(t(this).siblings().removeClass("active"),t(this).addClass("active"),n=t(this).attr("data-value")),e.setValue(n),e.onChange()})},_getActiveValues:function(){var e=[];return this.$el.find(".amarkal-ui-toggle-labels div.active").each(function(){e.push(t(this).attr("data-value"))}),e},_setActiveValues:function(e){var n=this.props.multi;this.$el.find(".amarkal-ui-toggle-labels div").each(function(){var i=t(this).attr("data-value");t(this).removeClass("active"),(n&&e.indexOf(i)>-1||!n&&e===i)&&t(this).addClass("active")})}})}(jQuery,window);